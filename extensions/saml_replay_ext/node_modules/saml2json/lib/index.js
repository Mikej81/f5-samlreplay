'use strict';

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var _require = require('xmldom'),
    DOMParser = _require.DOMParser;

var _require2 = require('xpath'),
    select = _require2.select;

var parse = function parse(assertion) {

  if (!assertion) {
    throw new Error('A SAML assertion is required!');
  }

  var xml = new Buffer(assertion, 'base64').toString('ascii');
  var doc = new DOMParser().parseFromString(xml);

  var statements = select('//*[local-name() = "AttributeStatement"]/*', doc).map(function (statement) {
    var attribute = select('string(@Name)', statement);
    return _defineProperty({}, attribute, select('string(*[local-name() = "AttributeValue"]/text())', statement));
  });

  return Object.assign.apply({}, statements);
};

module.exports.parse = parse;
