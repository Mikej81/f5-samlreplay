# f5-nodejs

This Node.js module for is used to access the ILX features of BIG-IP.
Use it to program the high-performance BIG-IP datapath from Node.js.

## Example

### "Echo" Server
nameThe following example shows a simple echo server that returns request parameters back in the response.

```javascript
var ILXServer = require('f5-nodejs').ILXServer,
    ilx = new ILXServer();

ilx.addMethod('echo', function(req, res) {
    res.reply(req.params());
});

ilx.listen();
```

The following iRule can be used to test this server (replace "my_plugin" and "my_extension" with relevant names).

```tcl
when HTTP_REQUEST {
    set uri [HTTP::uri]
    set ilx_init [ILX::init my_plugin my_extension]

    if { $uri == "/echo" } {
        # returns "Hello World"
        set ilx_call [ILX::call $ilx_init "echo" "Hello" "World"]
        HTTP::respond 200 content "$ilx_call\n"
    }
}
```


### "Hello World" Server
The following example shows a "hello world" server.
If the "hello" method is used and a name is provided then it returns "Hello <name>".
If no name is provided it returns an error.
If any other method is used then the default method will return "Hello World".

```javascript
var ILXServer = require('f5-nodejs').ILXServer,
    ilx = new ILXServer();

ilx.addMethod('hello', function(req, res) {
    var params = req.params();

    if (params) {
        res.reply('Hello ' + params[0]);

    } else {
        res.error('Invalid params', -32602);
    }
});

ilx.setDefaultMethod(function (req, res) {
    res.reply('Hello World');
});

ilx.listen();
```

The following iRule can be used to test this server (replace "my_plugin" and "my_extension" with relevant names).

```tcl
when HTTP_REQUEST {
    set uri [HTTP::uri]
    set ilx_init [ILX::init my_plugin my_extension]

    if { $uri == "/hello/good" } {
        # returns "Hello James"
        set ilx_call [ILX::call $ilx_init "hello" "James"]

    } elseif { $uri == "/hello/bad" } {
        # throws an error (log message in /var/log/ltm)
        set ilx_call [ILX::call $ilx_init "hello"]

    } elseif { $uri == "/foo" } {
        # returns "Hello World"
        set ilx_call [ILX::call $ilx_init "foo"]
    }

    HTTP::respond 200 content "$ilx_call\n"
}
```

## License

Copyright (C) F5 Networks, Inc. 2013-2015

No part of this software may be reproduced or transmitted in any form or by any means, electronic or mechanical, for any purpose, without express written permission of F5 Networks, Inc.

## Modules
<dl>
<dt><a href="#module_f5-nodejs">f5-nodejs</a></dt>
<dd></dd>
</dl>
## Classes
<dl>
<dt><a href="#ILXRequest">ILXRequest</a></dt>
<dd></dd>
<dt><a href="#ILXResponse">ILXResponse</a></dt>
<dd></dd>
<dt><a href="#ILXServer">ILXServer</a> ⇐ <code>net.Server</code></dt>
<dd></dd>
</dl>
<a name="module_f5-nodejs"></a>
## f5-nodejs

* [f5-nodejs](#module_f5-nodejs)
  * [.ILXServer](#module_f5-nodejs.ILXServer)
  * [.createILXServer([methods])](#module_f5-nodejs.createILXServer) ⇒ <code>[ILXServer](#ILXServer)</code>

<a name="module_f5-nodejs.ILXServer"></a>
### f5-nodejs.ILXServer
**Kind**: static class of <code>[f5-nodejs](#module_f5-nodejs)</code>
**See**: [ILXServer](#ILXServer)
<a name="module_f5-nodejs.createILXServer"></a>
### f5-nodejs.createILXServer([methods]) ⇒ <code>[ILXServer](#ILXServer)</code>
**Kind**: static method of <code>[f5-nodejs](#module_f5-nodejs)</code>
**Returns**: <code>[ILXServer](#ILXServer)</code> - instance of ILXServer

| Param | Type | Description |
| --- | --- | --- |
| [methods] | <code>object</code> | hash of methods in {name: callback} format (optional) |

<a name="ILXRequest"></a>
## ILXRequest
**Kind**: global class

* [ILXRequest](#ILXRequest)
  * [new ILXRequest(message)](#new_ILXRequest_new)
  * [.params()](#ILXRequest+params)

<a name="new_ILXRequest_new"></a>
### new ILXRequest(message)
Represents a request object passed to method callback.


| Param | Type | Description |
| --- | --- | --- |
| message | <code>object</code> | message object |

<a name="ILXRequest+params"></a>
### ilxRequest.params()
Returns the parameters of the request.

**Kind**: instance method of <code>[ILXRequest](#ILXRequest)</code>
<a name="ILXResponse"></a>
## ILXResponse
**Kind**: global class

* [ILXResponse](#ILXResponse)
  * [new ILXResponse(id, client)](#new_ILXResponse_new)
  * [.error(message, [code], [data])](#ILXResponse+error)
  * [.reply(result)](#ILXResponse+reply)

<a name="new_ILXResponse_new"></a>
### new ILXResponse(id, client)
Represents a response object passed to method callback.


| Param | Type | Description |
| --- | --- | --- |
| id | <code>string</code> | request id |
| client | <code>object</code> | client socket |

<a name="ILXResponse+error"></a>
### ilxResponse.error(message, [code], [data])
Returns an error to the client.

**Kind**: instance method of <code>[ILXResponse](#ILXResponse)</code>

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| message | <code>string</code> |  | error message |
| [code] | <code>int</code> | <code>30</code> | error code (optional) |
| [data] | <code>any</code> |  | additional data (optional) |

<a name="ILXResponse+reply"></a>
### ilxResponse.reply(result)
Returns a response to the client.

**Kind**: instance method of <code>[ILXResponse](#ILXResponse)</code>

| Param | Type | Description |
| --- | --- | --- |
| result | <code>any</code> | result |

<a name="ILXServer"></a>
## ILXServer ⇐ <code>net.Server</code>
**Kind**: global class
**Extends:** <code>net.Server</code>

* [ILXServer](#ILXServer) ⇐ <code>net.Server</code>
  * [new ILXServer([methods], [options])](#new_ILXServer_new)
  * _instance_
    * [.addMethod(name, callback)](#ILXServer+addMethod)
    * [.removeMethod(name)](#ILXServer+removeMethod)
    * [.setDefaultMethod(callback)](#ILXServer+setDefaultMethod)
    * [.listen([port])](#ILXServer+listen)
  * _inner_
    * [~methodCallback](#ILXServer..methodCallback) : <code>function</code>

<a name="new_ILXServer_new"></a>
### new ILXServer([methods], [options])
Represents a "multiplex" ILX server that accepts multiple messages over the same TCP connection.

Expected message format: <length:UInt32BE><json_rpc_string:string>


| Param | Type | Default | Description |
| --- | --- | --- | --- |
| [methods] | <code>object</code> |  | hash of methods in {name: callback} format (optional) |
| [options] | <code>object</code> |  | server options (optional) |
| [options.debug] | <code>boolean</code> | <code>false</code> | debug logging |
| [options.timeout] | <code>integer</code> | <code>5000</code> | TCP socket timeout in milliseconds |

<a name="ILXServer+addMethod"></a>
### ilxServer.addMethod(name, callback)
Add a method handler.

**Kind**: instance method of <code>[ILXServer](#ILXServer)</code>

| Param | Type | Description |
| --- | --- | --- |
| name | <code>string</code> | method name |
| callback | <code>[methodCallback](#ILXServer..methodCallback)</code> | that handles the request |

<a name="ILXServer+removeMethod"></a>
### ilxServer.removeMethod(name)
Remove a method handler.

**Kind**: instance method of <code>[ILXServer](#ILXServer)</code>

| Param | Type | Description |
| --- | --- | --- |
| name | <code>string</code> | method name |

<a name="ILXServer+setDefaultMethod"></a>
### ilxServer.setDefaultMethod(callback)
Set a default handler for when no other method is available.

**Kind**: instance method of <code>[ILXServer](#ILXServer)</code>

| Param | Type | Description |
| --- | --- | --- |
| callback | <code>[methodCallback](#ILXServer..methodCallback)</code> | callback that handles the request |

<a name="ILXServer+listen"></a>
### ilxServer.listen([port])
Listen to connections.

**Kind**: instance method of <code>[ILXServer](#ILXServer)</code>

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| [port] | <code>int</code> | <code>530</code> | port to listen on (optional) |

<a name="ILXServer..methodCallback"></a>
### ILXServer~methodCallback : <code>function</code>
Callback function that handles an incoming request.

**Kind**: inner typedef of <code>[ILXServer](#ILXServer)</code>

| Param | Type | Description |
| --- | --- | --- |
| request | <code>[ILXRequest](#ILXRequest)</code> | request object |
| [response] | <code>[ILXResponse](#ILXResponse)</code> | response object (not available for notifications) |

